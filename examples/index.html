<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>d3-heatmap2</title>
	
	<!-- Google Font -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400' rel='stylesheet' type='text/css'>

	<!-- d3-heatmap2 -->
	<link href='d3-heatmap2.css' rel='stylesheet' type='text/css'>

	<style>
		html { font-size: 62.5%; } 
		body {
		  	font-size: 1rem;
		  	font-family: 'Open Sans', sans-serif;
		  	font-weight: 400;
		  	fill: #8C8C8C;
		  	text-align: center;
		}
		.details {
			margin-top: 30px;
			font-family: 'Open Sans', sans-serif;
			font-size: 1.4rem;
			color: #8C8C8C;
		}
	</style>
	
</head>	
<body>
	<div id="chart"></div>
	<div id="details" class="details"></div>
	<!-- D3.js -->
	<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
	
	<!-- d3-heatmap2 -->
	<script src="d3-heatmap2.js"></script>

	<script>
		var chart = null
		var selectStart = null
		var selectEnd = null

		function select(cell) {
			if (!selectStart) {
				selectStart = cell
				chart.setHighlight([{"start": selectStart, "end": selectStart}])
				chart.updateHighlight()
			} else if (!selectEnd) {
				selectEnd = cell
				chart.setHighlight([{"start": selectStart, "end": selectEnd}])
				chart.updateHighlight()
			} else {
				selectStart = cell
				selectEnd = null
				chart.setHighlight([{"start": selectStart, "end": selectStart}])
				chart.updateHighlight()
			}
		}

		function hover(cell) {
			if (selectStart && !selectEnd) {
				if (cell[0] > selectStart[0]) { // column is higher
					chart.setHighlight([{"start": selectStart, "end": cell}])
					chart.updateHighlight()
				} else if (cell[0] = selectStart[0]) { // same column
					if (cell[1] >= selectStart[1]) { // row is higher or equal
						chart.setHighlight([{"start": selectStart, "end": cell}])
						chart.updateHighlight()
					} else {
						chart.setHighlight([{"start": selectStart, "end": selectStart}])
						chart.updateHighlight()
					}
				} else {
					chart.setHighlight([{"start": selectStart, "end": selectStart}])
					chart.updateHighlight()
				}
			}
		}

		d3.json("data.json", function(error, data) {
			if (error) return console.warn(error)
			function onClick(d, i, j) {
				console.info("Clicked on range " + data.rows[j] + ", time " + data.columns[i] + ", count " + d)
				select([i, j])
			}

			function onMouseOver(d, i, j) {
				document.getElementById("details").innerHTML = "time: " + data.columns[i] + ", range: " + data.rows[j] + ", count: " + d
				hover([i, j])
			}
		
			chart = d3.heatmap()
				.title("Latency Heatmap")
				.subtitle("github.com/spiermar/d3-heatmap2")
				.legendLabel("Count")
				.width(Math.max(Math.min(window.innerWidth, 1440), 960) - 20)
				.xAxisScale([0,122])
				.yAxisScale([106,1999])
				// .xAxisLabels(data.columns)
				// .yAxisLabels(data.rows)
				.highlightColor('#936EB5')
				.highlightOpacity('0.4')
				.onClick(onClick)
				.onMouseOver(onMouseOver)
				.colorScale(d3.scaleLinear()
					.domain([0, 65 / 2, 65])
					.range(['#F5F5DC', '#FF5032', '#E50914'])
				)
				
			d3.select("#chart")
				.datum(data.values)
				.call(chart)
		})
	</script>
</body>
</html>